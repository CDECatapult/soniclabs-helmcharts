apiVersion: apps/v1
kind: ConfigMap
metadata:
  name: {{ include "portal.fullname" . }}-configmap
  labels:
    {{- include "portal.labels" . | nindent 4 }}
data:
  config.js: |
    const config = {
      {{- with (index .Values.ingress.paths 0) }}
      REACT_APP_PUBLIC_BASE_PATH: '{{ .path }}',
      {{- end }}
      TEST_MANAGER_HOST: '{{ .Values.config.tma.host }}',
      TEST_MANAGER_PORT: '{{ .Values.config.tma.port }}',
      CONFIG_MANAGER_HOST: '{{ .Values.config.cma.host }}',
      CONFIG_MANAGER_PORT: '{{ .Values.config.cma.port }}',
      RESULTS_MANAGER_HOST: '{{ .Values.config.rma.host }}',
      RESULTS_MANAGER_PORT: '{{ .Values.config.rma.port }}',
      SUITE_MANAGER_HOST: '{{ .Values.config.sma.host }}',
      SUITE_MANAGER_PORT: '{{ .Values.config.sma.port }}'
    }

    if (!Window.config) {
      Window.config = {}
    }

    Window.config = Object.keys(config).reduce((out, next) => {
      if (!out.hasOwnProperty(next)) out[next] = config[next]
      return out
    }, {})
